{% extends "gamer_profiles/profile_base.html" %}
{% load avatar_tags i18n humanize social_tags ratings dash_tags rules %}
{% block subtitle %}{{ gamer }} - {% endblock %}
{% block sectiontitle %}{% avatar gamer.user class="avatar" %} {{ gamer }}{% endblock %}
{% block mobileheader %}{% avatar gamer.user class="avatar" %} {{ gamer }}{% endblock %}
{% block detailactive %}{% include "is_active_definition.html" %}{% endblock %}
{% block content %}
{% has_perm "postman.can_message_user" request.user gamer.user as can_message %}
<div class="grid-x grid-margin-x">
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "General info" %}</h5></div>
      <div class="card-section">
<dl>
  <dt>{% trans "Display Name" %}</dt>
  <dd>{{ gamer }}</dd>
  <dt>{% trans "Bio" %}</dt>
  <dd>{{ gamer.user.bio|default:"No info" }}</dd>
  {% if gamer.user.homepage_url %}
  <dt><a href="{{ gamer.user.homepage_url }}" rel="nofollow">{% trans "Homepage" %}</a></dt>
  <dd></dd>
  {% endif %}
  <dt>{% trans "Timezone" %}</dt>
  <dd>{{ gamer.user.get_timezone_display }}</dd>
  <dt>{% trans "RPG Experience" %}</dt>
  <dd>{{ gamer.rpg_experience|default:"No info" }}</dd>
  <dt>{% trans "Tabletop Game Experience" %}</dt>
  <dd>{{ gamer.ttgame_experience|default:"No info" }}</dd>
  <dt>{% trans "Playstyle" %}</dt>
  <dd>{{ gamer.playstyle|default:"No info" }}</dd>
</dl>
{% if request.user != gamer.user and can_message %}
<a href="{% url 'postman:write' gamer.username %}" class="button primary"><i class="fas fa-envelope"></i> {% trans "Message" %}</a>
{% endif %}
      </div>
    </div>
  </div>
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "Gamer stats" %}</h5></div>
      <div class="card-section">
        <h5>{% trans "GM Stats" %}</h5>
        {% if gamer.gmed_games.count == 0 %}
        <p>{% trans "No games GMed on LFG yet." %}</p>
        {% else %}
        <ul class="stats-list">
          <li{% stat_class_data gamer.gmed_games.count %}>{{ gamer.gmed_games.count }} <span class="stats-list-label">{% trans "Games created" %}</span></li>
          <li{% stat_class_data gamer.get_active_games.count %}>{{ gamer.get_active_games.count }} <span class="stats-list-label">{% trans "Active games" %}</span></li>
          <li{% stat_class_data gamer.get_sessions_run 50 -1 %}>{{ gamer.get_sessions_run|default_if_none:"0" }} <span class="stats-list-label">{% trans "Sessions run" %}</span></li>
          <li>{{ gamer.get_gm_finished_games.count }} <span class="stats-list-label">{% trans "Games finished" %}</span></li>
        </ul>
        {% endif %}
        <h5>{% trans "Player Stats" %}</h5>
        <ul class="stats-list">
          <li{% stat_class_data gamer.games_joined 10 -1 %}>{{ gamer.games_joined|default_if_none:"0" }} <span class="stats-list-label">{% trans "Games joined" %}</span></li>
          <li>{{ gamer.get_player_active_games.count|default_if_none:"0" }} <span class="stats-list-label">{% trans "Active games" %}</span></li>
          <li>{{ gamer.get_sessions_played|default_if_none:"0" }} <span class="stats-list-label">{% trans "Sessions played" %}</span></li>
          <li{% if gamer.games_left > gamer.games_finished %} class="stats-list-negative"{% endif %}>{{ gamer.games_left|default_if_none:"0" }} <span class="stats-list-label">{% trans "Games left" %}</span></li>
          <li{% stat_class_data gamer.games_finished 10 -1 %}>{{ gamer.games_finished|default_if_none:"0" }} <span class="stats-list-label">{% trans "Games finished" %}</span></li>
        </ul>
        <h5>{% trans "Communities" %}</h5>
        <ul class="stats-list">
          <li>{{ gamer.communities.count }} <span class="stats-list-label">{% trans "Member" %}</span></li>
          <li>{{ gamer.get_owned_communities.count }} <span class="stats-list-label">{% trans "Owner" %}</span></li>
          <li>{{ gamer.get_admined_communities.count }} <span class="stats-list-label">{% trans "Admin" %}</span></li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="grid-x grid-margin-x">
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "Status" %}</h5></div>
      <div class="card-section">

<table class="hover scroll">
  <thead><th>{% trans "Preference" %}</th><th>{% trans "Response" %}</th></thead>
  <tbody>
    <tr><td>{% trans "Current Status" %}</td><td>{{ gamer.get_player_status_display }}</td></tr>
    <tr><td>{% trans "Willing to GM" %}</td><td>{{ gamer.will_gm|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "Adult Themes OK?" %}</td><td>{{ gamer.adult_themes|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "One Shots?" %}</td><td>{{ gamer.one_shots|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "Adventures?" %}</td><td>{{ gamer.adventures|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "Campaigns?" %}</td><td>{{ gamer.campaigns|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "Online games?" %}</td><td>{{ gamer.online_games|yesno:_('Yes,No') }}</td></tr>
    <tr><td>{% trans "Local games?" %}</td><td>{{ gamer.local_games|yesno:_('Yes,No') }}</td></tr>
  </tbody>
</table>
      </div>
    </div>
  </div>
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "Generally available to play at" %}</h5></div>
      <div class="card-section">
{% has_perm "profile.see_detailed_availability" request.user gamer as see_avail_calendar %}
{% if see_avail_calendar %}
{% if week_availability %}
        <table class="hover scroll">

  <thead>
    <tr>
      <th width="200">{% trans "Weekday" %}</th>
      <th width="200" class="text-right">{% trans "Available times" %}</th>

    </tr>
  </thead>
  <tbody>
    {% get_weekday_list as weekday_list %}
    {% for wday in weekday_list %}
    <tr>
      <td>{{ wday }}</td>
      <td class="text-right">
        {% if forloop.counter0 == 0 %}
        {% with avail=week_availability.weekdays.0 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
          {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
          {% endif %}
          {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% elif forloop.counter0 == 1 %}
        {% with avail=week_availability.weekdays.1 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}


        {% elif forloop.counter0 == 2 %}
        {% with avail=week_availability.weekdays.2 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% elif forloop.counter0 == 3 %}
        {% with avail=week_availability.weekdays.3 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% elif forloop.counter0 == 4 %}
        {% with avail=week_availability.weekdays.4 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% elif forloop.counter0 == 5 %}
        {% with avail=week_availability.weekdays.5 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% else %}
        {% with avail=week_availability.weekdays.6 %}
        {% if avail %}
        {% if avail.seconds > 86000 %}
        <span class="label success">{% trans "Whenever" %}</span>
        {% else %}
        <span class="label primary">{{ avail.start|date:"H:i" }} - {{ avail.end|date:"H:i" }}</span>
        {% endif %}
        {% else %}
        <span class="label secondary">{% trans "Not available" %}</span>
        {% endif %}
        {% endwith %}

        {% endif %}
      </td>
    </tr>
      {% empty %}
      {% endfor %}
  </tbody>
</table>
{% else %}
{% if request.user == gamer.user %}
<p>{% trans "None set yet." %}</p>
{% else %}
<p>{% trans "Not known" %}</p>
{% endif %}
{% endif %}
{% if request.user == gamer.user %}
<a href="{% url 'gamer_profiles:set-available' %}" class="button primary"><i class="fas fa-edit"></i> {% trans "Set available times" %}</a>
{% endif %}
{% else %}
<p>{% trans "Hidden" %}</p>
{% endif %}
      </div>
    </div>
  </div>
</div>
<div class="grid-x grid-margin-x">
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "Favorites" %}</h5></div>
      <div class="card-section">

<h6>{% trans "Preferred Games" %}</h6>

<ul>
  {% for game in gamer.preferred_games.all %}
  <li><a href="{{ game.get_absolute_url }}">{{ game.title }}</a></li>
  {% empty %}
  <p>{% blocktrans with gname=gamer.display_name %}{{ gname }} hasn't listed any preferred games yet.{% endblocktrans %}</p>
  {% endfor %}
</ul>
<h6>{% trans "Preferred Systems" %}</h6>
<ul>
  {% for system in gamer.preferred_systems.all %}
  <li><a href="{{ system.get_absolute_url }}">{{ system.name }}</a></li>
  {% empty %}
  <p>{% blocktrans with gname=gamer.display_name %}{{ gname }} hasn't listed any preferred systems yet.{% endblocktrans %}</p>
  {% endfor %}
</ul>
    </div>
    </div>
  </div>
  {% if request.user.is_authenticated %}
  <div class="cell medium-auto">
    <div class="card">
      <div class="card-divider"><h5>{% trans "Gamer Metadata" %}</h5></div>
      <div class="card-section">
<div id="user-gamer-meta-data">
  <dl>
    <dt>{% trans "Average Rating" %}</dt>
    <dd>{{ gamer.avg_gamer_rating }}</dd>
    <dt>{% trans "Rate gamer" %}</dt>
    <dd>{% ratings gamer %}</dd>
    {% if request.user != gamer.user %}
    <hr />
    <dt>{% trans "Your notes on this gamer" %}</dt>
    <dd>
      <ol>
        {% for note in gamer_notes %}
        <li class="gamer-note">
          <div class="grid-x grid-margin-x">
            <div class="cell medium-4">
          <dl>
            <dt>{% trans "Title" %}</dt>
            <dd>{{ note.title }}</dd>
            <dt>{% trans "Note" %}</dt>
            <dd>{{ note.body_rendered|safe }}</dd>
          </dl>
            </div>
            <div class="cell medium-2">
              <dl>
            <dt>{% trans "Created" %}</dt>
            <dd>{{ note.created }}</dd>
            <dt>{% trans "Modified" %}</dt>
            <dd>{{ note.modified }}</dd>
              </dl>
            </div>
            <div class="cell medium-2">
            </div>
            <dl>
            <dt></dt>
            <dd><a href="{% url 'gamer_profiles:edit-gamernote' gamernote=note.pk %}" class="button primary">{% trans "Edit note" %}</a></dd>
            <dt></dt>
            <dd><a href="{% url 'gamer_profiles:delete-gamernote' gamernote=note.pk %}" class="button alert">{% trans "Delete note" %}</a> </dd>
            </dl>
          </div>
        </li>
        {% empty %}
        <p>{% trans "You have not made any notes for this gamer yet." %}</p>
        {% endfor %}
        <a href="{% url 'gamer_profiles:add-gamer-note' gamer=gamer.username %}"><button class="button primary">{% trans "Add a note" %}</button></a>
      </ol>
    </dd>
  </dl>
    {% endif %}
</div>
{% endif %}
      </div>
    </div>
  </div>
</div>
{% if gamer.user == request.user %}
<a href="{% url 'gamer_profiles:profile_export' gamer=gamer.username %}" class="button primary">{% trans "Export your profile data" %}</a>
{% endif %}


{% endblock %}
